seed_everything: 42
num_evaluation_seeds: 5
max_predictions: 32
num_classes: 12067
max_time_delta: 12
max_duration: 12
time_smoothing: null
history_density_horizons:
- 1
- 2
- 3
- 5
- 10
rnn_hidden_size: 64
rnn_inference_context: 94
rnn_inference_context_step: 30
transformer_context: 128
transformer_hidden_size: 32
transformer_heads: 2
transformer_layers: 1
transformer_positions: 126
transformer_pos_m: 0.1
transformer_pos_M: 100
max_intensity: null
ode_lipschitz: 2
thinning_params:
  max_steps: 100
  max_delta: ${max_time_delta}
  bound_samples: 100
next_k: 16
hypro_loss_step: 8
logger:
  _target_: pytorch_lightning.loggers.CSVLogger
  name: amazon_beauty_detpp_gru_k1_baseline
  save_dir: lightning_logs
model_path: checkpoints/${name}.ckpt
report: results/${name}.yaml
multiseed_report: results/multiseed_${name}.yaml
data_module:
  _target_: hotpp.data.HotppDataModule
  batch_size: 64
  min_length: 64
  max_length: 94
  num_workers: 0
  train_path: data/Amazon_Beauty/GTS-q0.9-val_last-test_random/train.parquet
  val_path: data/Amazon_Beauty/GTS-q0.9-val_last-test_random/val.parquet
  test_path: data/Amazon_Beauty/GTS-q0.9-val_last-test_random/test1.parquet
  val_params:
    global_target_fields:
    - target_labels
    - target_timestamps
  test_params:
    global_target_fields:
    - target_labels
    - target_timestamps
metric:
  _target_: hotpp.metrics.HorizonMetric
  max_time_delta: ${max_time_delta}
  horizon: 10
  horizon_evaluation_step: 4
  map_deltas:
  - 2
  map_target_length: 32
  otd_steps: null
  otd_insert_cost: null
  otd_delete_cost: null
head:
  _target_: hotpp.nn.Head
  _partial_: true
  hidden_dims:
  - 64
  use_batch_norm: true
conditional_head:
  _target_: hotpp.nn.ConditionalHead
  _partial_: true
  hidden_dims:
  - 128
  - 256
  use_batch_norm: true
  k: ${detection_k}
module:
  seq_encoder:
    _target_: hotpp.nn.RnnEncoder
    embedder:
      _target_: hotpp.nn.Embedder
      embeddings:
        labels:
          in: ${num_classes}
          out: 32
      numeric_values:
        timestamps: identity
    max_time_delta: ${max_time_delta}
    rnn_partial:
      _target_: hotpp.nn.GRU
      _partial_: true
      hidden_size: ${rnn_hidden_size}
    max_inference_context: ${rnn_inference_context}
    inference_context_step: ${rnn_inference_context_step}
  optimizer_partial:
    _partial_: true
    _target_: torch.optim.Adam
    lr: 0.001
    weight_decay: 0.0
  lr_scheduler_partial:
    _partial_: true
    _target_: torch.optim.lr_scheduler.StepLR
    step_size: 5
    gamma: 0.8
  val_metric: ${metric}
  test_metric: ${metric}
  _target_: hotpp.modules.NextKModule
  head_partial: ${conditional_head}
  loss:
    _target_: hotpp.losses.DetectionLoss
    k: ${detection_k}
    horizon: ${metric.horizon}
    next_item_adapter:
      timestamps: mode
      labels: mean
    next_item_loss:
      _target_: hotpp.losses.NextItemLoss
      losses:
        _presence:
          _target_: hotpp.losses.BinaryCrossEntropyLoss
        timestamps:
          _target_: hotpp.losses.TimeMAELoss
          delta: start
          max_delta: ${max_duration}
          smoothing: ${time_smoothing}
        labels:
          _target_: hotpp.losses.CrossEntropyLoss
          num_classes: ${num_classes}
    loss_subset: 0.25
    prefetch_factor: 0.75
    match_weights:
      _presence: 4
      timestamps: 0.5
      labels: 0.8
trainer:
  accelerator: cpu
  devices: 1
  max_epochs: 60
  enable_checkpointing: true
  deterministic: true
  precision: 32
  gradient_clip_val: 1
  check_val_every_n_epoch: 6
  model_selection:
    metric: val/T-mAP
    mode: max
name: amazon_beauty_detpp_gru_k1_baseline
detection_k: 1
